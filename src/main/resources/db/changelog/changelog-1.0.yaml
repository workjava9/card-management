databaseChangeLog:
  - changeSet:
      id: 1-create-users
      author: ai
      changes:
        - createTable:
            tableName: users
            columns:
              - column: { name: id, type: BIGSERIAL, constraints: { primaryKey: true } }
              - column: { name: username, type: VARCHAR(100), constraints: { nullable: false, unique: true } }
              - column: { name: password, type: VARCHAR(255), constraints: { nullable: false } }
              - column: { name: role, type: VARCHAR(30), constraints: { nullable: false } }
              - column: { name: enabled, type: BOOLEAN, defaultValueBoolean: true }
              - column: { name: created_at, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: CURRENT_TIMESTAMP }
              - column: { name: updated_at, type: TIMESTAMP WITH TIME ZONE }
  - changeSet:
      id: 2-create-cards
      author: ai
      changes:
        - createTable:
            tableName: cards
            columns:
              - column: { name: id, type: BIGSERIAL, constraints: { primaryKey: true } }
              - column: { name: owner_id, type: BIGINT, constraints: { nullable: false } }
              - column: { name: number_encrypted, type: VARCHAR(512), constraints: { nullable: false } }
              - column: { name: masked_number, type: VARCHAR(32), constraints: { nullable: false } }
              - column: { name: last4, type: VARCHAR(4), constraints: { nullable: false } }
              - column: { name: expiry_year, type: INT, constraints: { nullable: false } }
              - column: { name: expiry_month, type: INT, constraints: { nullable: false } }
              - column: { name: status, type: VARCHAR(30), constraints: { nullable: false } }
              - column: { name: balance, type: NUMERIC(19,2), defaultValueNumeric: 0.00, constraints: { nullable: false } }
              - column: { name: created_at, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: CURRENT_TIMESTAMP }
              - column: { name: updated_at, type: TIMESTAMP WITH TIME ZONE }
        - addForeignKeyConstraint:
            baseTableName: cards
            baseColumnNames: owner_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_cards_users
        - createIndex:
            indexName: idx_cards_owner
            tableName: cards
            columns:
              - column: { name: owner_id }
        - createIndex:
            indexName: idx_cards_last4
            tableName: cards
            columns:
              - column: { name: last4 }
